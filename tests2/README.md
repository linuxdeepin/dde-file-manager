# DDEæ–‡ä»¶ç®¡ç†å™¨ç°ä»£åŒ–å•å…ƒæµ‹è¯•æ¶æ„ (tests2)

è¿™æ˜¯DDEæ–‡ä»¶ç®¡ç†å™¨çš„ç°ä»£åŒ–å•å…ƒæµ‹è¯•åŸºç¡€è®¾æ–½ï¼ŒåŸºäº**é›¶ä¾µå…¥è‡ªåŠ¨æ–‡ä»¶å‘ç°**çš„è®¾è®¡ç†å¿µã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸš€ ä¸€é”®è¿è¡Œ**ï¼š`./run-ut.sh` å®Œæˆç¼–è¯‘+æµ‹è¯•+è¦†ç›–ç‡æŠ¥å‘Š
- **ğŸ” é›¶ä¾µå…¥**ï¼šå®Œå…¨ä¸ä¿®æ”¹ `src/` ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶
- **ğŸ¤– è‡ªåŠ¨å‘ç°**ï¼šè‡ªåŠ¨æ‰«ææºæ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ–‡ä»¶åˆ—è¡¨
- **ğŸ“Š è¦†ç›–ç‡æ”¶é›†**ï¼šè‡ªåŠ¨ç”ŸæˆHTMLæ ¼å¼è¦†ç›–ç‡æŠ¥å‘Š
- **ğŸ”§ ç§æœ‰æˆå‘˜è®¿é—®**ï¼šæ”¯æŒç™½ç›’æµ‹è¯•ï¼Œå¯è®¿é—®ç§æœ‰æˆå‘˜
- **âš¡ é«˜æ•ˆæ„å»º**ï¼šä½¿ç”¨CMakeå¯¹è±¡åº“ï¼Œé¿å…é‡å¤ç¼–è¯‘

## ğŸ¯ è§£å†³çš„é—®é¢˜

| ä¼ ç»Ÿæµ‹è¯•æ¶æ„é—®é¢˜ | æ–°æ¶æ„è§£å†³æ–¹æ¡ˆ |
|---|---|
| âŒ éœ€è¦ä¿®æ”¹æºç CMakeLists.txt | âœ… å®Œå…¨ä¸ä¿®æ”¹æºç ç›®å½• |
| âŒ æ‰‹åŠ¨ç»´æŠ¤æºæ–‡ä»¶åˆ—è¡¨ | âœ… è‡ªåŠ¨æ‰«æå’ŒåŒ…å«æºæ–‡ä»¶ |
| âŒ å¤æ‚çš„ä¾èµ–é…ç½® | âœ… æ ¹æ®ç»„ä»¶åè‡ªåŠ¨æ¨å¯¼ä¾èµ– |
| âŒ å¤šä¸ªè„šæœ¬éš¾ä»¥ä½¿ç”¨ | âœ… ä¸€ä¸ªè„šæœ¬å®Œæˆæ‰€æœ‰æ“ä½œ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰

```bash
cd tests2
./run-ut.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©
2. é…ç½®CMake
3. ç¼–è¯‘æ‰€æœ‰æµ‹è¯•
4. è¿è¡Œå•å…ƒæµ‹è¯•
5. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

### æ‰‹åŠ¨è¿è¡Œï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

```bash
cd tests2
mkdir build && cd build

# é…ç½®
cmake .. -DCMAKE_BUILD_TYPE=Debug

# ç¼–è¯‘
make -j$(nproc)

# è¿è¡Œæµ‹è¯•
ctest --output-on-failure

# ç”Ÿæˆè¦†ç›–ç‡
make coverage-all
```

## ğŸ“‚ ç›®å½•ç»“æ„

```
tests2/
â”œâ”€â”€ run-ut.sh                   # ğŸš€ ä¸€é”®è¿è¡Œè„šæœ¬
â”œâ”€â”€ CMakeLists.txt              # æ ¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ cmake/                      # CMakeå·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ DFMTestUtils.cmake      # æ ¸å¿ƒï¼šè‡ªåŠ¨æ–‡ä»¶å‘ç°
â”‚   â”œâ”€â”€ TestDiscovery.cmake     # æµ‹è¯•å‘ç°ç³»ç»Ÿ  
â”‚   â””â”€â”€ CoverageTargets.cmake   # è¦†ç›–ç‡ç›®æ ‡ç®¡ç†
â”œâ”€â”€ framework/                  # æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ dfm-test-base.h        # å¢å¼ºæµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ test-main.cpp          # é€šç”¨æµ‹è¯•å…¥å£
â”œâ”€â”€ units/                      # å•å…ƒæµ‹è¯•ï¼ˆæŒ‰ç»„ä»¶ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ dfm-framework/         # æ¡†æ¶ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ dfm-base/              # åŸºç¡€ç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ dfm-extension/         # æ‰©å±•ç»„ä»¶æµ‹è¯•
â””â”€â”€ fixtures/                  # æµ‹è¯•æ•°æ®å’Œå›ºä»¶
```

## ğŸ§ª æ·»åŠ æ–°æµ‹è¯•

### ä¸ºç°æœ‰ç»„ä»¶æ·»åŠ æµ‹è¯•

1. è¿›å…¥ç»„ä»¶æµ‹è¯•ç›®å½•ï¼š`tests2/units/dfm-framework/`
2. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼š`test_yourfeature.cpp`
3. æ–‡ä»¶ä¼šè‡ªåŠ¨è¢«å‘ç°å’Œç¼–è¯‘

### ä¸ºæ–°ç»„ä»¶æ·»åŠ æµ‹è¯•

1. åˆ›å»ºç»„ä»¶ç›®å½•ï¼š`mkdir tests2/units/your-component/`
2. åˆ›å»ºCMakeLists.txtï¼š
   ```cmake
   # ä»…éœ€ä¸€è¡Œé…ç½®ï¼
   dfm_create_component_test(your-component)
   ```
3. æ·»åŠ æµ‹è¯•æ–‡ä»¶ï¼š`test_*.cpp`

## ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼Œè¦†ç›–ç‡æŠ¥å‘Šä½ç½®ï¼š
- **æ‰€æœ‰ç»„ä»¶æ±‡æ€»**ï¼š`tests2/build/coverage/combined/index.html`
- **å•ä¸ªç»„ä»¶**ï¼š`tests2/build/coverage/{ç»„ä»¶å}/index.html`

æŸ¥çœ‹æ–¹æ³•ï¼š
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
firefox tests2/build/coverage/combined/index.html
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### è¿è¡Œç‰¹å®šç»„ä»¶çš„æµ‹è¯•

```bash
cd tests2/build
ctest -L dfm-framework --output-on-failure
```

### ç”Ÿæˆç‰¹å®šç»„ä»¶çš„è¦†ç›–ç‡

```bash
cd tests2/build
make coverage-dfm-framework
```

### æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„Makeç›®æ ‡

```bash
cd tests2/build
make help
```

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒåŸç†

1. **è‡ªåŠ¨æ–‡ä»¶å‘ç°**ï¼š
   ```cmake
   file(GLOB_RECURSE SOURCES "${PROJECT_SOURCE_DIR}/src/${COMPONENT}/*.cpp")
   ```

2. **å¯¹è±¡åº“æŠ€æœ¯**ï¼š
   ```cmake
   add_library(${COMPONENT}-test-objects OBJECT ${SOURCES})
   ```

3. **è¦†ç›–ç‡ç¼–è¯‘é€‰é¡¹**ï¼š
   ```cmake
   target_compile_options(${TARGET} PRIVATE -fprofile-arcs -ftest-coverage)
   ```

### æ”¯æŒçš„ç»„ä»¶

å½“å‰æ”¯æŒçš„ç»„ä»¶ï¼ˆè‡ªåŠ¨æ£€æµ‹`src/`ç›®å½•ï¼‰ï¼š
- `dfm-framework`: æ¡†æ¶ç»„ä»¶
- `dfm-base`: åŸºç¡€ç»„ä»¶  
- `dfm-extension`: æ‰©å±•ç»„ä»¶

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: è¿è¡Œ`./run-ut.sh`æç¤ºæƒé™é”™è¯¯**  
A: æ·»åŠ æ‰§è¡Œæƒé™ï¼š`chmod +x run-ut.sh`

**Q: CMakeé…ç½®å¤±è´¥ï¼Œæ‰¾ä¸åˆ°Qt6**  
A: å®‰è£…Qt6å¼€å‘åŒ…ï¼š`sudo apt-get install qt6-base-dev qt6-tools-dev`

**Q: æ‰¾ä¸åˆ°GTest**  
A: å®‰è£…GTestï¼š`sudo apt-get install libgtest-dev`

**Q: è¦†ç›–ç‡æŠ¥å‘Šä¸ç”Ÿæˆ**  
A: å®‰è£…lcovï¼š`sudo apt-get install lcov`

**Q: æµ‹è¯•ç¼–è¯‘å¤±è´¥ï¼Œæ‰¾ä¸åˆ°å¤´æ–‡ä»¶**  
A: æ£€æŸ¥`PROJECT_SOURCE_DIR`æ˜¯å¦æ­£ç¡®è®¾ç½®

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†è¾“å‡ºï¼š
```bash
cd tests2/build
cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_VERBOSE_MAKEFILE=ON
make VERBOSE=1
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **CMake**: >= 3.16
- **ç¼–è¯‘å™¨**: GCC/Clang æ”¯æŒC++17
- **Qt**: Qt6 (Core, Widgets, Test)
- **æµ‹è¯•æ¡†æ¶**: Google Test
- **è¦†ç›–ç‡å·¥å…·**: lcov, genhtml
- **ç³»ç»Ÿ**: Linux (Ubuntu/Debian æ¨è)

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è“å›¾è®¾è®¡æ–‡æ¡£](../ut-blueprint-zh-cn.md)
- [å¼€å‘è®¡åˆ’](../ut-plan.md)
- [ä»»åŠ¡å®ŒæˆæŠ¥å‘Š](TASK004-COMPLETION-REPORT.md)

---

**ğŸ‰ ç°ä»£åŒ–æµ‹è¯•çš„åŠ›é‡ï¼šä¸€è¡Œé…ç½®ï¼Œè‡ªåŠ¨åŒ–ä¸€åˆ‡ï¼**