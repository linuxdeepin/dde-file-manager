# DDEæ–‡ä»¶ç®¡ç†å™¨ç°ä»£åŒ–å•å…ƒæµ‹è¯•æ¶æ„

è¿™æ˜¯DDEæ–‡ä»¶ç®¡ç†å™¨çš„å•å…ƒæµ‹è¯•åŸºç¡€è®¾æ–½ï¼ŒåŸºäº**é›¶ä¾µå…¥è‡ªåŠ¨æ–‡ä»¶å‘ç°**çš„è®¾è®¡ç†å¿µã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸš€ ä¸€é”®è¿è¡Œ**ï¼š`./run-ut.sh` å®Œæˆç¼–è¯‘+æµ‹è¯•+è¦†ç›–ç‡æŠ¥å‘Š
- **ğŸ” é›¶ä¾µå…¥**ï¼šå®Œå…¨ä¸ä¿®æ”¹ `src/` ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶
- **ğŸ¤– è‡ªåŠ¨å‘ç°**ï¼šè‡ªåŠ¨æ‰«ææºæ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ–‡ä»¶åˆ—è¡¨
- **ğŸ“Š è¦†ç›–ç‡æ”¶é›†**ï¼šè‡ªåŠ¨ç”ŸæˆHTMLæ ¼å¼è¦†ç›–ç‡æŠ¥å‘Š
- **ğŸ”§ ç§æœ‰æˆå‘˜è®¿é—®**ï¼šæ”¯æŒç™½ç›’æµ‹è¯•ï¼Œå¯è®¿é—®ç§æœ‰æˆå‘˜
- **âš¡ é«˜æ•ˆæ„å»º**ï¼šä½¿ç”¨CMakeå¯¹è±¡åº“ï¼Œé¿å…é‡å¤ç¼–è¯‘
- **ğŸ¯ ç»Ÿä¸€ç›®æ ‡**ï¼šæ¯ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªæµ‹è¯•ç›®æ ‡ï¼Œé¿å…ç›®æ ‡è¿‡å¤š

## ğŸ¯ è§£å†³çš„é—®é¢˜

| ä¼ ç»Ÿæµ‹è¯•æ¶æ„é—®é¢˜ | æ–°æ¶æ„è§£å†³æ–¹æ¡ˆ |
|---|---|
| âŒ éœ€è¦ä¿®æ”¹æºç CMakeLists.txt | âœ… å®Œå…¨ä¸ä¿®æ”¹æºç ç›®å½• |
| âŒ æ‰‹åŠ¨ç»´æŠ¤æºæ–‡ä»¶åˆ—è¡¨ | âœ… è‡ªåŠ¨æ‰«æå’ŒåŒ…å«æºæ–‡ä»¶ |
| âŒ å¤æ‚çš„ä¾èµ–é…ç½® | âœ… æ ¹æ®ç»„ä»¶åè‡ªåŠ¨æ¨å¯¼ä¾èµ– |
| âŒ å¤šä¸ªè„šæœ¬éš¾ä»¥ä½¿ç”¨ | âœ… ä¸€ä¸ªè„šæœ¬å®Œæˆæ‰€æœ‰æ“ä½œ |
| âŒ æ¯ä¸ªcppæ–‡ä»¶ä¸€ä¸ªtarget | âœ… æ¯ä¸ªç»„ä»¶ä¸€ä¸ªç»Ÿä¸€çš„æµ‹è¯•target |

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç›®æ ‡æ˜ å°„å…³ç³»

```
src/
â”œâ”€â”€ dfm-framework/     â†’  autotests: dfm-framework-tests
â”œâ”€â”€ dfm-base/         â†’  autotests: dfm-base-tests  
â”œâ”€â”€ dfm-extension/    â†’  autotests: dfm-extension-tests
â””â”€â”€ ...               â†’  autotests: ...-tests
```

### ç»Ÿä¸€æµ‹è¯•ç›®æ ‡

æ¯ä¸ªç»„ä»¶çš„æ‰€æœ‰ `test_*.cpp` æ–‡ä»¶éƒ½ä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªç»Ÿä¸€çš„æµ‹è¯•ç›®æ ‡ä¸­ï¼š

```cmake
# ä¾‹å¦‚ï¼šdfm-frameworkç»„ä»¶
dfm-framework-tests:
  â”œâ”€â”€ test_eventsequence.cpp
  â”œâ”€â”€ test_framelogmanager.cpp
  â”œâ”€â”€ test_listener.cpp
  â”œâ”€â”€ test_plugin.cpp
  â””â”€â”€ ... (æ‰€æœ‰test_*.cppæ–‡ä»¶)
```

è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š
- **ğŸ¯ ç›®æ ‡æ•°é‡å¯æ§**ï¼šå³ä½¿æœ‰1000ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œä¹Ÿåªæœ‰ä¸ç»„ä»¶æ•°é‡ç›¸ç­‰çš„æµ‹è¯•ç›®æ ‡
- **ğŸš€ æ„å»ºæ•ˆç‡é«˜**ï¼šå‡å°‘äº†CMake targetçš„æ•°é‡ï¼Œæé«˜æ„å»ºé€Ÿåº¦
- **ğŸ“Š è¦†ç›–ç‡ç»Ÿä¸€**ï¼šæ¯ä¸ªç»„ä»¶çš„è¦†ç›–ç‡æ•°æ®ç»Ÿä¸€æ”¶é›†å’ŒæŠ¥å‘Š
- **ğŸ”§ ç®¡ç†ç®€å•**ï¼šè¿è¡Œã€è°ƒè¯•ã€åˆ†æéƒ½ä»¥ç»„ä»¶ä¸ºå•ä½

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰

```bash
cd autotests
./run-ut.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©
2. é…ç½®CMake
3. ç¼–è¯‘æ‰€æœ‰æµ‹è¯•
4. è¿è¡Œå•å…ƒæµ‹è¯•
5. ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

### æ‰‹åŠ¨è¿è¡Œï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

```bash
cd autotests
mkdir build && cd build

# é…ç½®
cmake .. -DCMAKE_BUILD_TYPE=Debug

# ç¼–è¯‘
make -j$(nproc)

# è¿è¡Œæµ‹è¯•
ctest --output-on-failure

# ç”Ÿæˆè¦†ç›–ç‡
make coverage-all
```

## ğŸ“‚ ç›®å½•ç»“æ„

```
autotests/
â”œâ”€â”€ run-ut.sh                   # ğŸš€ ä¸€é”®è¿è¡Œè„šæœ¬
â”œâ”€â”€ CMakeLists.txt              # æ ¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ cmake/                      # CMakeå·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ DFMTestUtils.cmake      # æ ¸å¿ƒï¼šè‡ªåŠ¨æ–‡ä»¶å‘ç°
â”‚   â”œâ”€â”€ TestDiscovery.cmake     # æµ‹è¯•å‘ç°ç³»ç»Ÿ  
â”‚   â””â”€â”€ CoverageTargets.cmake   # è¦†ç›–ç‡ç›®æ ‡ç®¡ç†
â”œâ”€â”€ framework/                  # æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ dfm-test-base.h        # å¢å¼ºæµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ test-main.cpp          # é€šç”¨æµ‹è¯•å…¥å£
â”œâ”€â”€ units/                      # å•å…ƒæµ‹è¯•ï¼ˆæŒ‰ç»„ä»¶ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ dfm-framework/         # æ¡†æ¶ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ dfm-base/              # åŸºç¡€ç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ dfm-extension/         # æ‰©å±•ç»„ä»¶æµ‹è¯•
â””â”€â”€ fixtures/                  # æµ‹è¯•æ•°æ®å’Œå›ºä»¶
```

## ğŸ§ª æ·»åŠ æ–°æµ‹è¯•

### ä¸ºç°æœ‰ç»„ä»¶æ·»åŠ æµ‹è¯•

1. è¿›å…¥ç»„ä»¶æµ‹è¯•ç›®å½•ï¼š`autotests/units/dfm-framework/`
2. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼š`test_yourfeature.cpp`
3. æ–‡ä»¶ä¼šè‡ªåŠ¨è¢«å‘ç°å¹¶åˆå¹¶åˆ° `dfm-framework-tests` ç›®æ ‡ä¸­

### ä¸ºæ–°ç»„ä»¶æ·»åŠ æµ‹è¯•

1. åˆ›å»ºç»„ä»¶ç›®å½•ï¼š`mkdir autotests/units/your-component/`
2. åˆ›å»ºCMakeLists.txtï¼š
   ```cmake
   # ä»…éœ€ä¸€è¡Œé…ç½®ï¼
   dfm_create_component_test(your-component)
   ```
3. æ·»åŠ æµ‹è¯•æ–‡ä»¶ï¼š`test_*.cpp`
4. ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º `your-component-tests` ç›®æ ‡

## ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼Œè¦†ç›–ç‡æŠ¥å‘Šä½ç½®ï¼š
- **æ‰€æœ‰ç»„ä»¶æ±‡æ€»**ï¼š`autotests/build/coverage/html/index.html`
- **å•ä¸ªç»„ä»¶**ï¼š`autotests/build/coverage/{ç»„ä»¶å}/html/index.html`

æŸ¥çœ‹æ–¹æ³•ï¼š
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
firefox autotests/build/coverage/html/index.html
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### è¿è¡Œç‰¹å®šç»„ä»¶çš„æµ‹è¯•

```bash
cd autotests/build
# è¿è¡Œdfm-frameworkç»„ä»¶çš„æµ‹è¯•
ctest -L dfm-framework --output-on-failure

# æˆ–è€…ç›´æ¥è¿è¡Œæµ‹è¯•ç›®æ ‡
./tests/dfm-framework/dfm-framework-tests
```

### ç”Ÿæˆç‰¹å®šç»„ä»¶çš„è¦†ç›–ç‡

```bash
cd autotests/build
make coverage-dfm-framework
```

### æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„Makeç›®æ ‡

```bash
cd autotests/build
make help
```

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒåŸç†

1. **è‡ªåŠ¨æ–‡ä»¶å‘ç°**ï¼š
   ```cmake
   file(GLOB_RECURSE SOURCES "${PROJECT_SOURCE_DIR}/src/${COMPONENT}/*.cpp")
   ```

2. **å¯¹è±¡åº“æŠ€æœ¯**ï¼š
   ```cmake
   add_library(${COMPONENT}-test-objects OBJECT ${SOURCES})
   ```

3. **ç»Ÿä¸€æµ‹è¯•ç›®æ ‡**ï¼š
   ```cmake
   add_executable(${COMPONENT}-tests ${ALL_TEST_FILES} $<TARGET_OBJECTS:${COMPONENT}-test-objects>)
   ```

4. **è¦†ç›–ç‡ç¼–è¯‘é€‰é¡¹**ï¼š
   ```cmake
   target_compile_options(${TARGET} PRIVATE -fprofile-arcs -ftest-coverage)
   ```

### æ”¯æŒçš„ç»„ä»¶

å½“å‰æ”¯æŒçš„ç»„ä»¶ï¼ˆè‡ªåŠ¨æ£€æµ‹`src/`ç›®å½•ï¼‰ï¼š
- `dfm-framework`: æ¡†æ¶ç»„ä»¶ â†’ `dfm-framework-tests`
- `dfm-base`: åŸºç¡€ç»„ä»¶ â†’ `dfm-base-tests`
- `dfm-extension`: æ‰©å±•ç»„ä»¶ â†’ `dfm-extension-tests`

### æµ‹è¯•ç›®æ ‡å‘½åè§„åˆ™

- ç»„ä»¶æºç ï¼š`src/{component}/`
- æµ‹è¯•ç›®å½•ï¼š`autotests/units/{component}/`
- æµ‹è¯•ç›®æ ‡ï¼š`{component}-tests`
- å¯¹è±¡åº“ï¼š`{component}-test-objects`

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: è¦†ç›–ç‡æŠ¥å‘Šä¸ç”Ÿæˆ**  
A: å®‰è£…lcovï¼š`sudo apt-get install lcov`

**Q: æµ‹è¯•ç›®æ ‡è¿‡å¤š**  
A: æ–°æ¶æ„å·²è§£å†³ï¼Œæ¯ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ªæµ‹è¯•ç›®æ ‡

**Q: å¦‚ä½•è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶**  
A: ä½¿ç”¨GTestçš„è¿‡æ»¤åŠŸèƒ½ï¼š`./dfm-framework-tests --gtest_filter="YourTestClass*"`

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†è¾“å‡ºï¼š
```bash
cd autotests/build
cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_VERBOSE_MAKEFILE=ON
make VERBOSE=1
```

## ğŸ¯ æ€§èƒ½ä¼˜åŠ¿

ä¸æ—§æ¶æ„ç›¸æ¯”ï¼š
- **ç›®æ ‡æ•°é‡**ï¼šä» Nä¸ªæµ‹è¯•æ–‡ä»¶ â†’ 1ä¸ªç»„ä»¶ç›®æ ‡
- **æ„å»ºé€Ÿåº¦**ï¼šå‡å°‘CMakeå¤„ç†æ—¶é—´
- **å†…å­˜ä½¿ç”¨**ï¼šå‡å°‘å¹¶è¡Œæ„å»ºæ—¶çš„å†…å­˜å ç”¨
- **ç®¡ç†å¤æ‚åº¦**ï¼šO(ç»„ä»¶æ•°) è€Œé O(æµ‹è¯•æ–‡ä»¶æ•°)

